# ChatQuest
 
## Development Notes
This is a completely serverless cloud based game and chat bot. 

The OAuth login cloud function sets up the quest and database entries and subscribes to EventSub for that broadcaster.

All logic is handled on each EventSub event that comes into the app.
- This will start the game with the "Start Quest" Reward
- Attack and deduct HP from the boss with the action rewards
- Determine if the boss was killed, and "Complete" the quest in the database.
- Refund points because of async nature if the boss's HP is already at or below zero.
- Clear out current quest from database, and start a new quest.

If a chat message needs to be sent to Twitch, it spins up a chat client, send the message, then disconnects from the chat server.
- This reduces costs because we don't need a server running 24/7 just to handle chat messages.
- The downfall to this process is there is a few second delay for each message because of the nature of serverless.
 - The upside, it is actually slows the game down a bit, and during testing it worked out really well because it didn't spam chat as fast as a natively running chatbot would.

## Setting Env Variables
Rename env.sample.json to env.json
```
{
    "config": {
        "twitchextclientid": "", //Get this from the Twitch Developer Console
        "twitchextsecret": "", //Get this from the Twitch Developer Console
        "twitchextapisecret": "", //Get this from the Twitch Developer Console
        "broadcasterredirecturl": "", //This gets generated when you deploy your project to firebase
        "chatbotredirecturl": "", //This gets generated when you deploy your project to firebase
        "chatbottwitchid": "", //Put a Twitch ID here that will be used for the chatbot.
        "eventsubredemptioncallbackurl": "" //This gets generated when you deploy your project to firebase
    }
}
```
**Note** This was created as a Twitch Extension for future enhancements, but the core app doesn't require an extension. If you just run as  a normal OAuth application, the `twitchextsecret` can be left blank.

Navigate to `/functions` folder and run `npm run update:env`

## Deploying to Firebase
run `firebase deploy`

## Login to Chatbot
Open the link generated after deploying to firebase for the function `chatBotLogin`.
This will ask you to login to Twitch, then save the token to Firebase's database to use as a cloud bot.

## Login to Twitch Broadcaster Account
Open the link generated by the function `broadcasterLogin`.
This will ask you to login to Twitch, then save the token to Firebase's database. 
This is used to create/delete Channel Point Rewards, and Fulfill or Cancel Reward Redemptions on the Twitch API.
